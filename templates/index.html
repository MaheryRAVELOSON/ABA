<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABA+ Framework Analyzer</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --text-color: #333;
            --border-color: #bdc3c7;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: bold;
        }
        .input-section {
            margin-bottom: 30px;
            background: var(--light-color);
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
        }
        textarea {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
            background: white;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        button {
            background: var(--accent-color);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        button:hover {
            background: var(--secondary-color);
            transform: translateY(-1px);
        }
        button:disabled {
            background: var(--border-color);
            color: #7f8c8d;
            cursor: not-allowed;
            transform: none;
        }
        button:disabled:hover {
            background: var(--border-color);
            transform: none;
        }
        .button-danger {
            background: var(--danger-color);
        }
        .button-danger:hover {
            background: #c0392b;
        }
        .button-success {
            background: var(--success-color);
        }
        .button-success:hover {
            background: #229954;
        }
        .button-warning {
            background: var(--warning-color);
        }
        .button-warning:hover {
            background: #e67e22;
        }
        .results {
            margin-top: 30px;
        }
        .section {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .section h3 {
            color: var(--primary-color);
            margin-top: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--light-color);
            padding-bottom: 10px;
        }
        .function-source {
            font-size: 0.8em;
            color: #7f8c8d;
            font-family: 'Courier New', monospace;
            background: var(--light-color);
            padding: 2px 8px;
            border-radius: 4px;
        }
        .arguments-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .argument-card {
            background: var(--light-color);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            transition: transform 0.3s;
        }
        .argument-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        .attack-list {
            max-height: 300px;
            overflow-y: auto;
            background: var(--light-color);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        .attack-item {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid var(--accent-color);
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border: 1px solid var(--border-color);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: var(--accent-color);
        }
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        .error {
            background: var(--danger-color);
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #c0392b;
        }
        .success {
            background: var(--success-color);
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #229954;
        }
        .warning {
            background: var(--warning-color);
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #e67e22;
        }
        .info {
            background: var(--accent-color);
            color: white;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #2980b9;
        }
        .framework-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .info-card {
            background: var(--light-color);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        .rules-list {
            background: var(--light-color);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        .rule-item {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid var(--accent-color);
            font-family: 'Courier New', monospace;
        }
        .contraries-list {
            background: var(--light-color);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        .contrary-item {
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid var(--accent-color);
        }
        .sub-section {
            margin-top: 15px;
        }
        .circular-dependencies {
            background: var(--light-color);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--danger-color);
            margin-bottom: 15px;
        }
        .cycle-item {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid var(--danger-color);
            font-family: 'Courier New', monospace;
        }
        .transformation-info {
            background: var(--light-color);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid var(--success-color);
            margin-bottom: 15px;
        }
        .transform-item {
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 4px;
        }
        @media (max-width: 768px) {
            .framework-info {
                grid-template-columns: 1fr;
            }
            .arguments-grid {
                grid-template-columns: 1fr;
            }
            .stats {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ABA+ Framework Analyzer (https://github.com/MaheryRAVELOSON/ABA.git)</h1>
        <h3>ABA+ Framework Analyzer (https://github.com/MaheryRAVELOSON/ABA.git)</h3>
        
        <div class="input-section">
            <h3>Entrez votre cadre ABA :</h3>
            <textarea id="abaInput" placeholder="L: [a,b,c,q,p,r,s,t]
A: [a,b,c]
C(a): r
C(b): s
C(c): t
[r1]: p <- q,a
[r2]: q <-
[r3]: r <- b,c
[r4]: t <- p,c
[r5]: s <- t
PREF: a > b">L: [a,b,p,q,r]
A: [a,b]
C(a): r
C(b): r
[r1]: p <- q
[r4]: a <- b
[r5]: b <- a
[r2]: q <- p
[r3]: r <- a,b</textarea>
            <div class="button-group">
                <button id="transformAtomicButton" onclick="processABA()">Transformer en Atomique</button>
                <button id="transformNonCircularButton" class="button-warning" onclick="transformNonCircularABA()" style="display: none;">Transformer en Non-Circulaire</button>
            </div>
        </div>

        <div id="loading" class="loading">
            <p>⏳ Analyse en cours...</p>
        </div>

        <div id="results" class="results" style="display: none;">
            <div id="successMessage" class="success"></div>
            <div id="warningMessage" class="warning" style="display: none;"></div>
            <div id="errorMessage" class="error" style="display: none;"></div>
            <div id="infoMessage" class="info" style="display: none;"></div>

            <!-- Circular Dependencies Section -->
            <div id="circularSection" class="section" style="display: none;">
                <h3>
                    Dépendances Circulaires Détectées
                    <span class="function-source">is_circular() + get_circular_dependencies()</span>
                </h3>
                <div class="circular-dependencies" id="circularDependencies"></div>
            </div>

            <!-- Transformation Info Section -->
            <div id="transformationSection" class="section" style="display: none;">
                <h3>
                    Détails de la Transformation
                    <span class="function-source">convert_to_non_circular()</span>
                </h3>
                <div class="transformation-info" id="transformationInfo"></div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalArguments">0</div>
                    <div>Arguments Générés</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalAttacks">0</div>
                    <div>Attaques ABA+ Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="normalAttacks">0</div>
                    <div>Attaques Normales</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="reverseAttacks">0</div>
                    <div>Attaques Inverses</div>
                </div>
            </div>

            <div class="section">
                <h3>
                    Informations du Cadre
                    <span class="function-source">parse_aba_input()</span>
                </h3>
                <div class="framework-info">
                    <div class="info-card">
                        <h4>Cadre Original</h4>
                        <p><strong>Langage:</strong> <span id="originalLanguage"></span></p>
                        <p><strong>Assomptions:</strong> <span id="originalAssumptions"></span></p>
                        <p><strong>Préférences:</strong> <span id="preferences"></span></p>
                        
                        <div class="sub-section">
                            <h5>Contraires Originaux</h5>
                            <div class="contraries-list" id="originalContraries"></div>
                        </div>

                        <div class="sub-section">
                            <h5>Règles Originales</h5>
                            <div class="rules-list" id="originalRules"></div>
                        </div>
                    </div>
                    <div class="info-card" id="atomicFrameworkCard">
                        <h4>
                            Cadre Atomique
                            <span class="function-source">convert_to_atomic()</span>
                        </h4>
                        <p><strong>Langage:</strong> <span id="atomicLanguage"></span></p>
                        <p><strong>Assomptions:</strong> <span id="atomicAssumptions"></span></p>
                        <p><strong>Règles:</strong> <span id="rulesCount"></span></p>
                        
                        <div class="sub-section">
                            <h5>Contraires Atomiques</h5>
                            <div class="contraries-list" id="atomicContraries"></div>
                        </div>
                    </div>
                </div>

                <div class="sub-section" id="atomicRulesSection">
                    <h4>Règles du Cadre Atomique</h4>
                    <div class="rules-list" id="rulesList"></div>
                </div>
            </div>

            <div class="section">
                <h3>
                    Arguments Générés
                    <span class="function-source">generate_arguments_optimized()</span>
                </h3>
                <div class="arguments-grid" id="argumentsGrid"></div>
            </div>

            <div class="section">
                <h3>
                    Attaques Normales (ABA+)
                    <span class="function-source">compute_normal_attacks()</span>
                </h3>
                <div class="attack-list" id="normalAttacksList"></div>
            </div>

            <div class="section">
                <h3>
                    Attaques Inverses (ABA+)
                    <span class="function-source">compute_reverse_attacks()</span>
                </h3>
                <div class="attack-list" id="reverseAttacksList"></div>
            </div>

            <div class="section">
                <h3>
                    Attaques Standard (ABA simple)
                    <span class="function-source">compute_standard_attacks()</span>
                </h3>
                <div class="attack-list" id="standardAttacksList"></div>
            </div>

            <!-- Détails de transformation -->
            <div class="section" id="transformationDetailsSection" style="display: none;">
                <h3>
                    Détails de la Transformation
                    <span class="function-source">convert_to_non_circular()</span>
                </h3>
                
                <div class="framework-info">
                    <div class="info-card">
                        <h4>Cadre Original</h4>
                        <p><strong>Assomptions:</strong> <span id="transformationOriginalAssumptions"></span></p>
                        <p><strong>Règles Originales:</strong> <span id="transformationOriginalRulesCount"></span></p>
                        <div class="sub-section">
                            <h5>Règles Détaillées</h5>
                            <div class="rules-list" id="transformationOriginalRules"></div>
                        </div>
                    </div>
                    
                    <div class="info-card">
                        <h4>Cadre Transformé</h4>
                        <p><strong>Nouvelles Assomptions:</strong> <span id="transformationNewAssumptions"></span></p>
                        <p><strong>Nouvelles Règles:</strong> <span id="transformationNewRulesCount"></span></p>
                        <div class="sub-section">
                            <h5>Règles Transformées</h5>
                            <div class="rules-list" id="transformationNewRules"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentABAText = '';
        let currentIsCircular = false;
        let lastProcessedText = '';

        // Réinitialiser l'état quand l'utilisateur modifie le texte
        function resetButtonState() {
            const currentText = document.getElementById('abaInput').value;
            
            // Si le texte a changé depuis la dernière analyse
            if (currentText !== lastProcessedText) {
                const transformAtomicButton = document.getElementById('transformAtomicButton');
                const transformNonCircularButton = document.getElementById('transformNonCircularButton');
                
                // Réactiver tous les boutons pour la nouvelle analyse
                transformAtomicButton.disabled = false;
                transformNonCircularButton.style.display = 'none';
                
                // Cacher les résultats précédents
                document.getElementById('results').style.display = 'none';
                document.getElementById('successMessage').style.display = 'none';
                document.getElementById('warningMessage').style.display = 'none';
                document.getElementById('errorMessage').style.display = 'none';
                document.getElementById('infoMessage').style.display = 'none';
                document.getElementById('circularSection').style.display = 'none';
                document.getElementById('transformationSection').style.display = 'none';
            }
        }

        // Écouter les modifications du texte
        document.getElementById('abaInput').addEventListener('input', resetButtonState);

        function processABA() {
            currentABAText = document.getElementById('abaInput').value;
            
            // Vérifier si le texte est vide
            if (!currentABAText.trim()) {
                const errorMessage = document.getElementById('errorMessage');
                errorMessage.textContent = 'Veuillez entrer un cadre ABA valide.';
                errorMessage.style.display = 'block';
                document.getElementById('results').style.display = 'block';
                return;
            }

            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const warningMessage = document.getElementById('warningMessage');
            const infoMessage = document.getElementById('infoMessage');
            const transformAtomicButton = document.getElementById('transformAtomicButton');
            const transformNonCircularButton = document.getElementById('transformNonCircularButton');
            const circularSection = document.getElementById('circularSection');
            const transformationSection = document.getElementById('transformationSection');
            const atomicFrameworkCard = document.getElementById('atomicFrameworkCard');
            const atomicRulesSection = document.getElementById('atomicRulesSection');

            loading.style.display = 'block';
            results.style.display = 'none';
            errorMessage.style.display = 'none';
            warningMessage.style.display = 'none';
            infoMessage.style.display = 'none';
            circularSection.style.display = 'none';
            transformationSection.style.display = 'none';
            
            // Toujours afficher les sections atomiques par défaut pour la transformation atomique
            atomicFrameworkCard.style.display = 'block';
            atomicRulesSection.style.display = 'block';

            fetch('/process', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({aba_text: currentABAText})
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                lastProcessedText = currentABAText; // Mettre à jour le texte traité
                
                if (data.success) {
                    currentIsCircular = data.is_circular;
                    displayResults(data);
                    
                    if (data.is_circular) {
                        warningMessage.textContent = 'Le cadre ABA est CIRCULAIRE. La transformation atomique ne peut pas être appliquée directement.';
                        warningMessage.style.display = 'block';
                        transformNonCircularButton.style.display = 'inline-block';
                        transformAtomicButton.disabled = true;
                        circularSection.style.display = 'block';
                        displayCircularDependencies(data.circular_dependencies);
                    } else {
                        successMessage.textContent = 'Cadre ABA non-circulaire - Transformation atomique réussie!';
                        successMessage.style.display = 'block';
                        transformNonCircularButton.style.display = 'none';
                        transformAtomicButton.disabled = false;
                    }
                    
                    results.style.display = 'block';
                } else {
                    errorMessage.textContent = 'Erreur: ' + data.error;
                    errorMessage.style.display = 'block';
                    results.style.display = 'block';
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                errorMessage.textContent = 'Erreur de connexion: ' + error;
                errorMessage.style.display = 'block';
                results.style.display = 'block';
            });
        }

        function transformNonCircularABA() {
            currentABAText = document.getElementById('abaInput').value;
            
            // Vérifier si le texte a changé depuis la dernière analyse
            if (currentABAText !== lastProcessedText) {
                const infoMessage = document.getElementById('infoMessage');
                infoMessage.textContent = 'Le cadre a été modifié. Veuillez d\'abord analyser le cadre avec "Transformer en Atomique".';
                infoMessage.style.display = 'block';
                document.getElementById('results').style.display = 'block';
                return;
            }

            // Si le cadre est déjà non-circulaire, afficher un message
            if (!currentIsCircular) {
                const infoMessage = document.getElementById('infoMessage');
                infoMessage.textContent = 'Le cadre est déjà non-circulaire. Aucune transformation nécessaire.';
                infoMessage.style.display = 'block';
                document.getElementById('results').style.display = 'block';
                return;
            }

            const loading = document.getElementById('loading');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const warningMessage = document.getElementById('warningMessage');
            const infoMessage = document.getElementById('infoMessage');
            const transformAtomicButton = document.getElementById('transformAtomicButton');
            const transformationSection = document.getElementById('transformationSection');
            const atomicFrameworkCard = document.getElementById('atomicFrameworkCard');
            const atomicRulesSection = document.getElementById('atomicRulesSection');

            loading.style.display = 'block';
            errorMessage.style.display = 'none';
            warningMessage.style.display = 'none';
            infoMessage.style.display = 'none';

            // Cacher les sections atomiques pour la transformation non-circulaire
            atomicFrameworkCard.style.display = 'none';
            atomicRulesSection.style.display = 'none';

            fetch('/transform_non_circular', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({aba_text: currentABAText})
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                
                if (data.success) {
                    currentIsCircular = false; // Maintenant c'est non-circulaire
                    displayResults(data);
                    successMessage.textContent = 'Transformation en cadre non-circulaire réussie!';
                    successMessage.style.display = 'block';
                    transformationSection.style.display = 'block';
                    displayTransformationInfo(data.transformation_info);
                    
                    // Cacher le bouton de transformation non-circulaire et réactiver le bouton atomique
                    document.getElementById('transformNonCircularButton').style.display = 'none';
                    transformAtomicButton.disabled = false;
                    
                    // S'assurer que les sections atomiques restent cachées
                    atomicFrameworkCard.style.display = 'none';
                    atomicRulesSection.style.display = 'none';
                } else {
                    errorMessage.textContent = 'Erreur lors de la transformation: ' + data.error;
                    errorMessage.style.display = 'block';
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                errorMessage.textContent = 'Erreur de connexion: ' + error;
                errorMessage.style.display = 'block';
            });
        }

        function displayCircularDependencies(dependencies) {
            const element = document.getElementById('circularDependencies');
            element.innerHTML = '';
            
            if (dependencies.length === 0) {
                element.innerHTML = '<p>Aucune circularité détectée.</p>';
                return;
            }

            dependencies.forEach((cycle, index) => {
                const cycleItem = document.createElement('div');
                cycleItem.className = 'cycle-item';
                cycleItem.innerHTML = `<strong>Cycle ${index + 1}:</strong> ${cycle.join(' → ')} → ${cycle[0]}`;
                element.appendChild(cycleItem);
            });
        }

        function displayTransformationInfo(info) {
            const element = document.getElementById('transformationInfo');
            element.innerHTML = '';
            
            let items = [];
            
            if (info.transformation_type === 'non_circular') {
                items = [
                    `k = |L \\ A| = ${info.k_value}`,
                    `Non-assomptions originaux: ${info.non_assumptions.join(', ')}`,
                    `Langage original: ${info.original_language_size} symboles → ${info.transformed_language_size} symboles`,
                    `Règles originales: ${info.original_rules_count} règles → ${info.transformed_rules_count} règles`
                ];
            } else if (info.transformation_type === 'atomic') {
                items = [
                    `Transformation: Cadre original → Cadre atomique`,
                    `Langage original: ${info.original_language_size} symboles → ${info.atomic_language_size} symboles`,
                    `Assomptions originales: ${info.original_assumptions_count} → ${info.atomic_assumptions_count}`,
                    `Règles originales: ${info.original_rules_count} → ${info.atomic_rules_count}`,
                    `Nouvelles assomptions: ${info.new_assumptions.join(', ')}`
                ];
            }
            
            items.forEach(item => {
                const transformItem = document.createElement('div');
                transformItem.className = 'transform-item';
                transformItem.textContent = item;
                element.appendChild(transformItem);
            });
        }

        function displayResults(data) {
            console.log('Données reçues:', data);
            
            // Update statistics if available
            if (data.arguments) {
                document.getElementById('totalArguments').textContent = data.arguments.length;
                document.getElementById('totalAttacks').textContent = data.attacks.total_aba_plus;
                document.getElementById('normalAttacks').textContent = data.attacks.normal;
                document.getElementById('reverseAttacks').textContent = data.attacks.reverse;
            } else {
                document.getElementById('totalArguments').textContent = '0';
                document.getElementById('totalAttacks').textContent = '0';
                document.getElementById('normalAttacks').textContent = '0';
                document.getElementById('reverseAttacks').textContent = '0';
            }

            // Update framework info
            document.getElementById('originalLanguage').textContent = data.framework_info.original_language.join(', ');
            document.getElementById('originalAssumptions').textContent = data.framework_info.original_assumptions.join(', ');
            document.getElementById('preferences').textContent = data.framework_info.preferences.map(p => `${p[0]} > ${p[1]}`).join(', ');

            // Display original contraries
            displayContraries('originalContraries', data.framework_info.original_contraries);

            // Display original rules
            displayRules('originalRules', data.framework_info.original_rules);

            // Gestion de l'affichage du cadre atomique
            const atomicFrameworkCard = document.getElementById('atomicFrameworkCard');
            const atomicRulesSection = document.getElementById('atomicRulesSection');
            
            if (data.atomic_framework && data.transformation_type !== 'non_circular') {
                // Afficher le cadre atomique seulement si ce n'est pas une transformation non-circulaire
                atomicFrameworkCard.style.display = 'block';
                atomicRulesSection.style.display = 'block';
                
                document.getElementById('atomicLanguage').textContent = data.atomic_framework.language.join(', ');
                document.getElementById('atomicAssumptions').textContent = data.atomic_framework.assumptions.join(', ');
                document.getElementById('rulesCount').textContent = data.atomic_framework.rules_count;
                displayContraries('atomicContraries', data.atomic_framework.contraries);
                displayRules('rulesList', data.atomic_framework.rules);
            } else {
                // Cacher le cadre atomique pour les transformations non-circulaires
                atomicFrameworkCard.style.display = 'none';
                atomicRulesSection.style.display = 'none';
            }

            // Display arguments if available
            const argumentsGrid = document.getElementById('argumentsGrid');
            argumentsGrid.innerHTML = '';
            if (data.arguments && data.arguments.length > 0) {
                data.arguments.forEach(arg => {
                    const argumentCard = document.createElement('div');
                    argumentCard.className = 'argument-card';
                    argumentCard.innerHTML = `
                        <strong>Argument ${arg.id}</strong><br>
                        <strong>Conclusion:</strong> ${arg.conclusion}<br>
                        <strong>Support:</strong> {${arg.support.join(', ')}}
                    `;
                    argumentsGrid.appendChild(argumentCard);
                });
            } else {
                argumentsGrid.innerHTML = '<p>Aucun argument généré (cadre circulaire ou transformation nécessaire)</p>';
            }

            // Display attacks if available
            if (data.attack_details) {
                displayAttackList('normalAttacksList', data.attack_details.normal);
                displayAttackList('reverseAttacksList', data.attack_details.reverse);
                displayAttackList('standardAttacksList', data.attack_details.standard);
            } else {
                document.getElementById('normalAttacksList').innerHTML = '<p>Aucune attaque calculée (cadre circulaire)</p>';
                document.getElementById('reverseAttacksList').innerHTML = '<p>Aucune attaque calculée (cadre circulaire)</p>';
                document.getElementById('standardAttacksList').innerHTML = '<p>Aucune attaque calculée (cadre circulaire)</p>';
            }
            
            // Afficher les détails de transformation si disponibles
            const transformationDetailsSection = document.getElementById('transformationDetailsSection');
            if (data.transformation_info) {
                transformationDetailsSection.style.display = 'block';
                
                // Afficher les détails de transformation
                document.getElementById('transformationOriginalAssumptions').textContent = data.transformation_info.original_assumptions.join(', ');
                document.getElementById('transformationNewAssumptions').textContent = data.transformation_info.transformed_assumptions.join(', ');
                document.getElementById('transformationOriginalRulesCount').textContent = data.transformation_info.original_rules_count;
                document.getElementById('transformationNewRulesCount').textContent = data.transformation_info.transformed_rules_count;
                
                // Afficher les règles détaillées
                displayRules('transformationOriginalRules', data.transformation_info.original_rules);
                displayRules('transformationNewRules', data.transformation_info.transformed_rules);
            } else {
                transformationDetailsSection.style.display = 'none';
            }
        }

        function displayRules(elementId, rules) {
            const element = typeof elementId === 'string' ? document.getElementById(elementId) : elementId;
            element.innerHTML = '';
            
            if (!rules || rules.length === 0) {
                element.innerHTML = '<p>Aucune règle définie.</p>';
                return;
            }

            rules.forEach(rule => {
                const ruleItem = document.createElement('div');
                ruleItem.className = 'rule-item';
                const premises = rule.premises.length > 0 ? rule.premises.join(', ') : '∅';
                ruleItem.innerHTML = `<strong>${rule.name}:</strong> ${rule.conclusion} ← ${premises}`;
                element.appendChild(ruleItem);
            });
        }

        function displayContraries(elementId, contraries) {
            const element = document.getElementById(elementId);
            element.innerHTML = '';
            
            if (Object.keys(contraries).length === 0) {
                element.innerHTML = '<p>Aucun contraire défini.</p>';
                return;
            }

            Object.entries(contraries).forEach(([assumption, contrary]) => {
                const contraryItem = document.createElement('div');
                contraryItem.className = 'contrary-item';
                contraryItem.innerHTML = `<strong>C(${assumption})</strong> = ${contrary}`;
                element.appendChild(contraryItem);
            });
        }

        function displayAttackList(elementId, attacks) {
            const element = document.getElementById(elementId);
            element.innerHTML = '';
            
            if (!attacks || attacks.length === 0) {
                element.innerHTML = '<p>Aucune attaque de ce type détectée.</p>';
                return;
            }

            attacks.forEach(attack => {
                const attackItem = document.createElement('div');
                attackItem.className = 'attack-item';
                attackItem.innerHTML = attack.description;
                element.appendChild(attackItem);
            });
        }

        // Process the default example on page load
        window.onload = function() {
            processABA();
        };
    </script>
</body>
</html>